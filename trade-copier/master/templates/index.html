<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Copier - Master Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4ff, #7b2fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-item .label {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
        }

        .status-item .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00d4ff;
        }

        .status-item .value.connected {
            color: #00ff88;
        }

        .status-item .value.disconnected {
            color: #ff4444;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: #000;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: #fff;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .copy-toggle {
            padding: 15px 40px;
            font-size: 1.2rem;
        }

        .copy-toggle.enabled {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
        }

        .copy-toggle.disabled {
            background: linear-gradient(135deg, #666, #444);
        }

        .panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .panel {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
        }

        .panel h2 {
            font-size: 1.2rem;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .follower-list {
            list-style: none;
        }

        .follower-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .follower-name {
            font-weight: 600;
        }

        .follower-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00ff88;
        }

        .status-dot.inactive {
            background: #666;
        }

        .signal-log {
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
        }

        .signal-entry {
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .signal-entry .time {
            color: #666;
        }

        .signal-entry .action {
            font-weight: bold;
        }

        .signal-entry .buy {
            color: #00ff88;
        }

        .signal-entry .sell {
            color: #ff4444;
        }

        .no-data {
            color: #666;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>üéØ Trade Copier</h1>
        <p>Master Control Dashboard</p>
    </div>

    <div class="status-bar">
        <div class="status-item">
            <div class="label">Connection</div>
            <div class="value" id="connection-status">Loading...</div>
        </div>
        <div class="status-item">
            <div class="label">Balance</div>
            <div class="value" id="balance">$0.00</div>
        </div>
        <div class="status-item">
            <div class="label">Followers</div>
            <div class="value" id="follower-count">0</div>
        </div>
        <div class="status-item">
            <div class="label">Signals Sent</div>
            <div class="value" id="signal-count">0</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn copy-toggle enabled" id="copy-toggle" onclick="toggleCopy()">
            ‚úÖ COPY ENABLED
        </button>
        <button class="btn btn-danger" onclick="flattenAll()">
            ‚ö†Ô∏è FLATTEN ALL
        </button>
    </div>

    <div class="panels">
        <div class="panel">
            <h2>üë• Connected Followers</h2>
            <ul class="follower-list" id="follower-list">
                <li class="no-data">No followers connected</li>
            </ul>
        </div>

        <div class="panel">
            <h2>üìú Signal Log</h2>
            <div class="signal-log" id="signal-log">
                <div class="no-data">No signals yet</div>
            </div>
        </div>
    </div>

    <script>
        let copyEnabled = true;

        async function fetchStatus() {
            try {
                const resp = await fetch('/api/status');
                const data = await resp.json();

                // Update connection status
                const connEl = document.getElementById('connection-status');
                connEl.textContent = data.connected ? 'üü¢ Connected' : 'üî¥ Disconnected';
                connEl.className = 'value ' + (data.connected ? 'connected' : 'disconnected');

                // Update balance
                document.getElementById('balance').textContent = '$' + data.account_balance.toLocaleString(undefined, { minimumFractionDigits: 2 });

                // Update followers
                document.getElementById('follower-count').textContent = data.followers.length;

                // Update signals
                document.getElementById('signal-count').textContent = data.total_signals;

                // Update copy button
                copyEnabled = data.copy_enabled;
                updateCopyButton();

                // Update follower list
                const list = document.getElementById('follower-list');
                if (data.followers.length > 0) {
                    list.innerHTML = data.followers.map(f => `
                        <li class="follower-item">
                            <span class="follower-name">${f.name}</span>
                            <span class="follower-status">
                                <span class="status-dot ${f.copy_enabled ? '' : 'inactive'}"></span>
                                ${f.signals_executed}/${f.signals_received} executed
                            </span>
                        </li>
                    `).join('');
                } else {
                    list.innerHTML = '<li class="no-data">No followers connected</li>';
                }

            } catch (err) {
                console.error('Status fetch error:', err);
            }
        }

        async function fetchSignalHistory() {
            try {
                const resp = await fetch('/api/signal_history');
                const data = await resp.json();

                const log = document.getElementById('signal-log');
                if (data.signals.length > 0) {
                    log.innerHTML = data.signals.reverse().map(s => `
                        <div class="signal-entry">
                            <span class="time">${new Date(s.timestamp).toLocaleTimeString()}</span>
                            <span class="action ${s.side.toLowerCase()}">${s.action} ${s.side} ${s.quantity} ${s.symbol}</span>
                            @ ${s.entry_price}
                        </div>
                    `).join('');
                }
            } catch (err) {
                console.error('Signal history error:', err);
            }
        }

        function updateCopyButton() {
            const btn = document.getElementById('copy-toggle');
            if (copyEnabled) {
                btn.className = 'btn copy-toggle enabled';
                btn.textContent = '‚úÖ COPY ENABLED';
            } else {
                btn.className = 'btn copy-toggle disabled';
                btn.textContent = '‚ùå COPY DISABLED';
            }
        }

        async function toggleCopy() {
            try {
                await fetch('/api/toggle_copy', { method: 'POST' });
                fetchStatus();
            } catch (err) {
                console.error('Toggle error:', err);
            }
        }

        async function flattenAll() {
            if (confirm('‚ö†Ô∏è This will FLATTEN ALL POSITIONS for you and all followers. Are you sure?')) {
                try {
                    await fetch('/api/flatten_all', { method: 'POST' });
                    alert('Flatten signal sent to all followers');
                } catch (err) {
                    console.error('Flatten error:', err);
                }
            }
        }

        // Initial load
        fetchStatus();
        fetchSignalHistory();

        // Auto-refresh every 2 seconds
        setInterval(fetchStatus, 2000);
        setInterval(fetchSignalHistory, 5000);
    </script>
</body>

</html>